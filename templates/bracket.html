<!DOCTYPE html>
<html>
  <head>
    <style>
      canvas {
        border: 1px solid black;
      }
    </style>
    <meta charset="UTF-8" />
    <title>TournamentsEZ - Bracket</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    <header>
      <h1>TournamentsEZ</h1>
    </header>
    <nav>
      <a href="{{ url_for('home') }}">Home</a>
      <a href="{{ url_for('host') }}">Host</a>
      <a href="{{ url_for('tournament') }}">Tournaments</a>
      <a href="{{ url_for('signup') }}">Sign Up</a>
      <a href="{{ url_for('bracket') }}">Bracket</a>
    </nav>
    <div class="container">
      <form action="/bracket" method="POST">
        <label for="tournament_name">Select a Tournament:</label>
        <select name="tournament_name" id="tournament_name">
          {% for tournament in tournaments %}
          <option value="{{ tournament.name }}">{{ tournament.name }}</option>
          {% endfor %}
        </select>
        <button type="submit">Generate Bracket</button>
      </form>
    </div>

    {% if selected_tournament %}
    <h2>Bracket for {{ selected_tournament }}</h2>
    <canvas id="treeCanvas" width="800" height="600"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/6.7.0/d3.min.js"></script>
    <script>
      var players = {{ pl | tojson }};

      var canvas = d3.select("#treeCanvas");
      var context = canvas.node().getContext("2d");

      // Set the canvas size
      canvas.attr("width", 800);
      canvas.attr("height", 600);

      function drawTree(node, x, y, level) {
        if (!node) return;

        var radius = 20;  // Increase the radius for larger nodes
        var offsetX = 40;  // Increase the offset for more space between nodes horizontally
        var offsetY = 60;  // Increase the offset for more space between nodes vertically
        var nodeX = x + level * offsetX;
        var nodeY = y + level * offsetY;

        context.beginPath();
        context.arc(nodeX, nodeY, radius, 0, 2 * Math.PI);
        context.fillStyle = "lightblue";
        context.fill();
        context.stroke();

        context.fillStyle = "black";
        context.textAlign = "center";
        context.textBaseline = "middle";
        context.fillText(node, nodeX, nodeY);

        if (players[2 * level + 1]) {
          drawTree(players[2 * level + 1], nodeX, nodeY + offsetY, level + 1);
        }

        if (players[2 * level + 2]) {
          drawTree(players[2 * level + 2], nodeX, nodeY + offsetY, level + 1);
        }
      }

      // Calculate the initial coordinates to center the tree
      var canvasWidth = canvas.node().width;
      var canvasHeight = canvas.node().height;
      var initialX = canvasWidth / 2;
      var initialY = canvasHeight / 2 - offsetY;  // Adjust the Y-coordinate to center the tree vertically

      drawTree(players[0], initialX, initialY, 0);
    </script>
    
    {% endif %}
  </body>
</html>
