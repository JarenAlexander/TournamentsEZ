<!DOCTYPE html>
<html>
  <head>
    <style>
      canvas {
        border: 1px solid black;
      }
    </style>
    <meta charset="UTF-8" />
    <title>TournamentsEZ - Bracket</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    <header>
      <h1>TournamentsEZ</h1>
    </header>
    <nav>
      <a href="{{ url_for('home') }}">Home</a>
      <a href="{{ url_for('host') }}">Host</a>
      <a href="{{ url_for('tournament') }}">Tournaments</a>
      <a href="{{ url_for('signup') }}">Sign Up</a>
      <a href="{{ url_for('bracket') }}">Bracket</a>
    </nav>
    
      <form action="/bracket" method="POST">
        <label for="tournament_name">Select a Tournament:</label>
        <select name="tournament_name" id="tournament_name">
          {% for tournament in tournaments %}
          <option value="{{ tournament.name }}">{{ tournament.name }}</option>
          {% endfor %}
        </select>
        <button type="submit">Generate Bracket</button>
      </form>
    

    {% if selected_tournament %}
    <h2>Bracket for {{ selected_tournament }}</h2>
    <canvas id="treeCanvas" width="800" height="600"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/6.7.0/d3.min.js"></script>
    <script>
      var players = {{ pl | tojson }};

      var canvas = d3.select("#treeCanvas");
      var context = canvas.node().getContext("2d");

      function drawTree(node, x, y, level) {
        if (!node) return;

        var radius = 10;
        var offsetX = 20;
        var offsetY = 20;
        var nodeX = x + level * offsetX;
        var nodeY = y;

        context.beginPath();
        context.arc(nodeX, nodeY, radius, 0, 2 * Math.PI);
        context.fillStyle = "lightblue";
        context.fill();
        context.stroke();

        context.fillStyle = "black";
        context.textAlign = "center";
        context.textBaseline = "middle";
        context.fillText(node, nodeX, nodeY);

        if (players[2 * level + 1]) {
          drawTree(players[2 * level + 1], nodeX, nodeY + offsetY, level + 1);
        }

        if (players[2 * level + 2]) {
          drawTree(players[2 * level + 2], nodeX, nodeY - offsetY, level + 1);
        }
      }

      drawTree(players[0], canvas.node().width / 2, 10, 0);
    </script>
    
    
    {% endif %}
  </body>
</html>
